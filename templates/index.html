<div id="page-dashboard" class="page-content active-section">
    <h2 class="text-3xl font-black mb-10 uppercase italic">Sistem Özeti</h2>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <div class="bg-white p-8 rounded-3xl shadow-sm border-l-8 border-emerald-500">
            <p class="text-xs font-bold text-slate-400 uppercase mb-2">Toplam Kazanç</p>
            <h3 id="dash-kazanc" class="text-3xl font-black text-emerald-600">₺0</h3>
        </div>
        <div class="bg-white p-8 rounded-3xl shadow-sm border-l-8 border-blue-600">
            <p class="text-xs font-bold text-slate-400 uppercase mb-2">Stok Değeri</p>
            <h3 id="dash-deger" class="text-3xl font-black text-slate-800">****</h3>
            <button onclick="hesaplaDashboard()" class="mt-4 text-[10px] bg-blue-50 text-blue-600 px-4 py-2 rounded-full font-bold uppercase tracking-wider">Verileri Güncelle</button>
        </div>
        <div class="bg-white p-8 rounded-3xl shadow-sm border-l-8 border-orange-500">
            <p class="text-xs font-bold text-slate-400 uppercase mb-2">Raporlama</p>
            <div class="flex gap-2 mt-2">
                <button onclick="exportExcel('invoices')" class="bg-green-600 text-white p-3 rounded-xl text-[10px] font-bold uppercase flex-1 hover:bg-green-700 transition-all"><i class="fas fa-file-excel mr-2"></i>Excel</button>
                <button onclick="sendDashboardGmail()" class="bg-orange-600 text-white p-3 rounded-xl text-[10px] font-bold uppercase flex-1 hover:bg-orange-700 transition-all"><i class="fas fa-envelope mr-2"></i>Gmail</button>
            </div>
        </div>
    </div>
</div>

<script>
    // --- TÜRKÇE KARAKTER SORUNU ÇÖZÜLMÜŞ EXCEL FONKSİYONU ---
    async function exportExcel(api) {
        try {
            const res = await fetch(`/api/${api}`);
            const data = await res.json();
            
            // Excel için veriyi hazırla
            const ws = XLSX.utils.json_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, "OzcanOtoRapor");

            // Karakter hatasını önlemek için yazma ayarları
            XLSX.writeFile(wb, `OzcanOto_${api}_Log.xlsx`, { bookType: 'xlsx', type: 'binary' });
        } catch (err) {
            alert("Excel hatası: " + err.message);
        }
    }

    // --- GMAIL DASHBOARD RAPORU ---
    async function sendDashboardGmail() {
        const statsRes = await fetch('/api/dashboard-stats');
        const stats = await statsRes.json();
        const bugun = new Date().toLocaleString('tr-TR');
        
        let body = `ÖZCAN OTO PRO - GÜNLÜK ÖZET RAPOR\n`;
        body += `Tarih: ${bugun}\n`;
        body += `-----------------------------------\n`;
        body += `TOPLAM KAZANÇ: ${stats.kazanc}\n`;
        body += `DEPO STOK DEĞERİ: ${stats.depo}\n`;
        body += `-----------------------------------\n`;
                
        window.location.href = `mailto:?subject=Ozcan Oto Gunluk Rapor&body=${encodeURIComponent(body)}`;
    }

    // --- DASHBOARD VERİLERİNİ ÇEKME ---
    async function hesaplaDashboard() {
        const res = await fetch('/api/dashboard-stats');
        const stats = await res.json();
        document.getElementById('dash-kazanc').innerText = stats.kazanc;
        document.getElementById('dash-deger').innerText = stats.depo;
    }

    // Sayfa yüklendiğinde hesapla
    window.onload = () => {
        showPage('dashboard');
        hesaplaDashboard();
    };
    
    // ... (Diğer fonksiyonlar: showPage, sil, yukleStok vb. öncekiyle aynı kalacak) ...
</script>
